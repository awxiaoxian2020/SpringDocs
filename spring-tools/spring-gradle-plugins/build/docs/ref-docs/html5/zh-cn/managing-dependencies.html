<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<!--[if IE]><meta http-equiv="X-UA-Compatible" content="IE=edge"><![endif]-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 1.5.8">
<title>依赖管理</title>
<style>
@import 'http://resources.jcohy.com/css/spring.css';

.listingblock .switch {
    border-style: none;
    display: inline-block;
    position: relative;
    bottom: -3px;
}

.listingblock .switch--item {
    padding: 10px;
    background-color: #e6e1dc;
    color: #282c34;
    display: inline-block;
    cursor: pointer;
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
}

.listingblock .switch--item:not(:first-child) {
    border-style: none;
}

.listingblock .switch--item.selected {
    background-color: #282c34;
    color: #e6e1dc;
}

.listingblock pre.highlightjs {
    padding: 0;
}

</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
.hidden {
	display: none;
}

.switch {
	border-width: 1px 1px 0 1px;
	border-style: solid;
	border-color: #7a2518;
	display: inline-block;
}

.switch--item {
	padding: 10px;
	background-color: #ffffff;
	color: #7a2518;
	display: inline-block;
	cursor: pointer;
}

.switch--item:not(:first-child) {
	border-width: 0 0 0 1px;
	border-style: solid;
	border-color: #7a2518;
}

.switch--item.selected {
	background-color: #7a2519;
	color: #ffffff;
}
</style>
<script src="https://cdnjs.cloudflare.com/ajax/libs/zepto/1.2.0/zepto.min.js"></script>
<script type="text/javascript">
function addBlockSwitches() {
	$('.primary').each(function() {
		primary = $(this);
		createSwitchItem(primary, createBlockSwitch(primary)).item.addClass("selected");
		primary.children('.title').remove();
	});
	$('.secondary').each(function(idx, node) {
		secondary = $(node);
		primary = findPrimary(secondary);
		switchItem = createSwitchItem(secondary, primary.children('.switch'));
		switchItem.content.addClass('hidden');
		findPrimary(secondary).append(switchItem.content);
		secondary.remove();
	});
}

function createBlockSwitch(primary) {
	blockSwitch = $('<div class="switch"></div>');
	primary.prepend(blockSwitch);
	return blockSwitch;
}

function findPrimary(secondary) {
	candidate = secondary.prev();
	while (!candidate.is('.primary')) {
		candidate = candidate.prev();
	}
	return candidate;
}

function createSwitchItem(block, blockSwitch) {
	blockName = block.children('.title').text();
	content = block.children('.content').first().append(block.next('.colist'));
	item = $('<div class="switch--item">' + blockName + '</div>');
	item.on('click', '', content, function(e) {
		$(this).addClass('selected');
		$(this).siblings().removeClass('selected');
		e.data.siblings('.content').addClass('hidden');
		e.data.removeClass('hidden');
	});
	blockSwitch.append(item);
	return {'item': item, 'content': content};
}

function globalSwitch() {
	$('.switch--item').each(function() {
		$(this).off('click');
		$(this).on('click', function() {
			selectedText = $(this).text()
			selectedIndex = $(this).index()
			$(".switch--item").filter(function() { return ($(this).text() === selectedText) }).each(function() {
				$(this).addClass('selected');
				$(this).siblings().removeClass('selected');
				selectedContent = $(this).parent().siblings(".content").eq(selectedIndex)
				selectedContent.removeClass('hidden');
				selectedContent.siblings().addClass('hidden');
			});
		});
	});
}

$(addBlockSwitches);
$(globalSwitch);

</script>

</head>
<body class="book toc2 toc-left">
<div id="header">
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#managing-dependencies">1. 依赖管理</a>
<ul class="sectlevel2">
<li><a href="#managing-dependencies-dependency-management-plugin">1.1. Managing Dependencies with the Dependency Management Plugin</a></li>
<li><a href="#managing-dependencies-dependency-management-plugin-customizing">1.2. 自定义管理版本号</a></li>
<li><a href="#managing-dependencies-dependency-management-plugin-using-in-isolation">1.3. 单独使用 Spring Boot 的依赖管理</a></li>
<li><a href="#managing-dependencies-learning-more">1.4. 更多</a></li>
<li><a href="#managing-dependencies-gradle-bom-support">1.5. 使用 Gradle 的 Bom 支持依赖管理</a>
<ul class="sectlevel3">
<li><a href="#managing-dependencies-gradle-bom-support-customizing">1.5.1. 自定义版本管理</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="content">
<div class="sect1">
<h2 id="managing-dependencies"><a class="anchor" href="#managing-dependencies"></a>1. 依赖管理</h2>
<div class="sectionbody">
<div class="paragraph">
<p>要管理 Spring Boot 应用程序中的依赖关系,可以应用 <code>io.spring.dependency-management</code> 插件,或者,如果您使用的是 Gradle 6 或更高版本,请使用 Gradle 的本地 bom 支持. 前者的主要优点是它提供了基于属性的托管版本的的自定义,而使用后者则会加快构建速度.</p>
</div>
<div class="sect2">
<h3 id="managing-dependencies-dependency-management-plugin"><a class="anchor" href="#managing-dependencies-dependency-management-plugin"></a>1.1. Managing Dependencies with the Dependency Management Plugin</h3>
<div class="paragraph">
<p>当使用了  {dependency-management-plugin}[<code>io.spring.dependency-management</code>] 插件, Spring Boot 的插件会自动地从你使用的 Spring Boot 版本里导入 <a href="#reacting-to-other-plugins-dependency-management">import the <code>spring-boot-dependencies</code> bom</a>.
Maven用户使用起来感觉区别不大. 比如, 允许你在声明依赖的时候忽略掉版本号, 使用这项功能, 只需要正常的声明依赖, 不用写版本号就可以了.</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">dependencies {
    implementation('org.springframework.boot:spring-boot-starter-web')
    implementation('org.springframework.boot:spring-boot-starter-data-jpa')
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Kotlin</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">dependencies {
    implementation("org.springframework.boot:spring-boot-starter-web")
    implementation("org.springframework.boot:spring-boot-starter-data-jpa")
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="managing-dependencies-dependency-management-plugin-customizing"><a class="anchor" href="#managing-dependencies-dependency-management-plugin-customizing"></a>1.2. 自定义管理版本号</h3>
<div class="paragraph">
<p>当应用了依赖管理插件, <code>spring-boot-dependencies</code> bom 会被自动导入, 使用属性控制它管理的依赖的版本号. 点击  {github-code}/spring-boot-project/spring-boot-dependencies/pom.xml[bom] 查看完整的属性列表.</p>
</div>
<div class="paragraph">
<p>如果要自定义管理版本, 设置它的扩展属性. 比如, 自定义被管理的 SLF4J 的版本号, 设置  <code>slf4j.version</code>  属性:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">ext['slf4j.version'] = '1.7.20'</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Kotlin</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">extra["slf4j.version"] = "1.7.20"</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
每个Spring Boot版本都与制定的第三方依赖设计和测试好了. 覆盖版本可能会造成兼容问题, 所以自定义的时候小心一点
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="managing-dependencies-dependency-management-plugin-using-in-isolation"><a class="anchor" href="#managing-dependencies-dependency-management-plugin-using-in-isolation"></a>1.3. 单独使用 Spring Boot 的依赖管理</h3>
<div class="paragraph">
<p>我们不用将 Spring Boot 的插件应用于项目, 也可以在项目中使用 Spring Boot 的依赖管理.  <code>SpringBootPlugin</code> 类提供一个 <code>BOM_COORDINATES</code> 常量, 可用于导入 Bom, 而不必知道其 artifact ID, group ID 或 version 号.</p>
</div>
<div class="paragraph">
<p>首先, 将项目配置为依赖于 Spring Boot 插件, 但不要应用它:</p>
</div>
<div class="paragraph">
<p>Spring Boot 插件对依赖管理插件的依赖意味着您可以使用依赖管理插件而不必声明对它的依赖.  这也意味着您将自动使用与 Spring Boot 使用的版本相同的依赖管理插件.</p>
</div>
<div class="paragraph">
<p>应用依赖管理插件, 然后将其配置为导入 Spring Boot 的 Bom:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">apply plugin: 'io.spring.dependency-management'

dependencyManagement {
    imports {
        mavenBom org.springframework.boot.gradle.plugin.SpringBootPlugin.BOM_COORDINATES
    }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Kotlin</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">apply(plugin = "io.spring.dependency-management")

the&lt;DependencyManagementExtension&gt;().apply {
    imports {
        mavenBom(org.springframework.boot.gradle.plugin.SpringBootPlugin.BOM_COORDINATES)
    }
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>上面的Kotlin代码有点尴尬.  那是因为我们使用命令式方式来应用依赖管理插件.</p>
</div>
<div class="paragraph">
<p>我们可以通过应用根父项目中的插件, 或者像在使用 Spring Boot 插件一样使用 <code>plugins</code> 块, 来减少代码的尴尬.  该方法的缺点是它迫使我们指定依赖管理插件的版本:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">plugins {
    java
    id("org.springframework.boot") version "2.3.8.RELEASE" apply false
    id("io.spring.dependency-management") version "{dependency-management-plugin-version}"
}

dependencyManagement {
    imports {
        mavenBom(org.springframework.boot.gradle.plugin.SpringBootPlugin.BOM_COORDINATES)
    }
}</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="managing-dependencies-learning-more"><a class="anchor" href="#managing-dependencies-learning-more"></a>1.4. 更多</h3>
<div class="paragraph">
<p>要了解有关依赖管理插件功能的更多信息, 请参阅其  {dependency-management-plugin-documentation}[documentation].</p>
</div>
</div>
<div class="sect2">
<h3 id="managing-dependencies-gradle-bom-support"><a class="anchor" href="#managing-dependencies-gradle-bom-support"></a>1.5. 使用 Gradle 的 Bom 支持依赖管理</h3>
<div class="paragraph">
<p>Gradle 通过将 Bom 声明为  <code>platform</code> 或  <code>enforcedPlatform</code> 依赖,可用于管理项目的版本. <code>platform</code> 依赖将 bom 中的版本视为推荐版本,这可能会导致项目中的其他版本或者依赖关系中的其他版本与此 bom 声明的版本不同. <code>enforcedPlatform</code> 依赖将 bom 中的版本视为要求,它们将覆盖依赖关系中找到的任何其他版本.</p>
</div>
<div class="paragraph">
<p><code>SpringBootPlugin</code> 类提供 <code>BOM_COORDINATES</code> 常量,可用于声明对 Spring Boot 的 bom 的依赖关系,而不必知道其 group ID, artifact ID 或 version,如以下示例所示:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">dependencies {
    implementation platform(org.springframework.boot.gradle.plugin.SpringBootPlugin.BOM_COORDINATES)
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Kotlin</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">dependencies {
    implementation(platform(org.springframework.boot.gradle.plugin.SpringBootPlugin.BOM_COORDINATES))
}</code></pre>
</div>
</div>
<div class="paragraph">
<p>platform 或 enforced platform 将只在声明它的配置中具有约束性,或者在声明它的配置的扩展的地址.因此,可能需要在多个配置中声明相同的依赖.</p>
</div>
<div class="sect3">
<h4 id="managing-dependencies-gradle-bom-support-customizing"><a class="anchor" href="#managing-dependencies-gradle-bom-support-customizing"></a>1.5.1. 自定义版本管理</h4>
<div class="paragraph">
<p>使用 Gradle 的 bom 支持时,您不能使用 <code>spring-boot-dependencies</code> 中的属性来控制它管理的依赖的版本. 相反,您必须使用 Gradle 提供的一种机制. 一种这样的机制是解决策略. SLF4J 的模块全部在 <code>org.slf4j</code> 组中,因此可以通过将该组中的每个依赖配置为使用特定版本来控制其版本,如以下示例所示:</p>
</div>
<div class="listingblock primary">
<div class="title">Groovy</div>
<div class="content">
<pre class="highlight"><code class="language-groovy" data-lang="groovy">configurations.all {
    resolutionStrategy.eachDependency { DependencyResolveDetails details -&gt;
        if (details.requested.group == 'org.slf4j') {
            details.useVersion '1.7.20'
        }
    }
}</code></pre>
</div>
</div>
<div class="listingblock secondary">
<div class="title">Kotlin</div>
<div class="content">
<pre class="highlight"><code class="language-kotlin" data-lang="kotlin">configurations.all {
    resolutionStrategy.eachDependency {
        if (requested.group == "org.slf4j") {
            useVersion("1.7.20")
        }
    }
}</code></pre>
</div>
</div>
<div class="admonitionblock warning">
<table>
<tr>
<td class="icon">
<i class="fa icon-warning" title="Warning"></i>
</td>
<td class="content">
每个 Spring Boot 版本都是针对一组特定的第三方依赖进行设计和测试的.覆盖版本可能会引起兼容性问题,因此应格外小心.
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 2.3.8.RELEASE<br>
Last updated 2021-02-06 11:59:22 +0800
</div>
</div>
<script type="text/javascript" src="http://resources.jcohy.com/js/tocbot/tocbot.min.js"></script>
<script type="text/javascript" src="http://resources.jcohy.com/js/toc.js"></script>
<script type="text/javascript" src="http://resources.jcohy.com/js/switch-language.js"></script>
</body>
</html>